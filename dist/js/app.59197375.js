(function(e){function t(t){for(var n,c,i=t[0],r=t[1],l=t[2],v=0,u=[];v<i.length;v++)c=i[v],Object.prototype.hasOwnProperty.call(s,c)&&s[c]&&u.push(s[c][0]),s[c]=0;for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n]);d&&d(t);while(u.length)u.shift()();return o.push.apply(o,l||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],n=!0,i=1;i<a.length;i++){var r=a[i];0!==s[r]&&(n=!1)}n&&(o.splice(t--,1),e=c(c.s=a[0]))}return e}var n={},s={app:0},o=[];function c(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,c),a.l=!0,a.exports}c.m=e,c.c=n,c.d=function(e,t,a){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(c.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)c.d(a,n,function(t){return e[t]}.bind(null,n));return a},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],r=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var d=r;o.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"034f":function(e,t,a){"use strict";a("85ec")},1:function(e,t){},2:function(e,t){},3:function(e,t){},"439a":function(e,t,a){},"50fb":function(e,t,a){"use strict";a("f3d9")},"56d7":function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-app",[a("v-app-bar",{attrs:{dense:"",app:"",color:"dark",dark:""}},[a("div",{staticClass:"d-flex align-center"},[a("v-img",{staticClass:"shrink mr-2",attrs:{alt:"Vuetify Logo",contain:"",src:"https://cdn.vuetifyjs.com/images/logos/vuetify-logo-dark.png",transition:"scale-transition",width:"40"}}),e._v(" Roll Play Stage ")],1),a("v-spacer"),a("v-app-bar-nav-icon",{on:{click:function(t){t.stopPropagation(),e.drawer=!e.drawer}}})],1),a("v-navigation-drawer",{attrs:{absolute:"",app:"",bottom:"",right:"",persistent:""},model:{value:e.drawer,callback:function(t){e.drawer=t},expression:"drawer"}},[a("SidePanel")],1),a("v-main",[a("Canvas")],1)],1)},o=[],c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{staticClass:"pa-0",attrs:{fluid:""}},[a("div",{on:{drop:function(t){return t.preventDefault(),e.addTokenDrag(t)},dragover:function(e){e.preventDefault()},dblclick:e.resetZoom}},[a("v-card",{attrs:{height:"100%"}},[a("canvas",{ref:"can",staticStyle:{border:"1px solid black"},attrs:{width:"640",height:"480"}}),a("div",{on:{drop:function(t){t.preventDefault(),e.bgDrag=!0},dragover:function(e){e.preventDefault()}}},[a("v-card",{staticClass:"minimap",staticStyle:{position:"absolute",top:"10px",left:"10px"},attrs:{outlined:""}},[a("canvas",{ref:"mini",attrs:{width:"80",height:"80"}})])],1)])],1),a("v-btn",{attrs:{dense:"",disabled:!e.objectSelected},on:{click:e.removeToken}},[e._v("remove")]),a("v-btn",{attrs:{dense:""},on:{click:e.testMethod}},[e._v("TEST BUTTON")])],1)},i=[],r=a("5530"),l=(a("159b"),a("4de4"),a("b64b"),a("b0c0"),a("bf19"),a("260b")),d=(a("66ce"),{apiKey:"AIzaSyCY2RisfrQSJ_2spRpgmTQIVXCpHMKUBI8",authDomain:"roll-play-stage.firebaseapp.com",projectId:"roll-play-stage",storageBucket:"roll-play-stage.appspot.com",messagingSenderId:"1021674062807",appId:"1:1021674062807:web:11171850dd1eb9fff00192"}),v=l["a"].initializeApp(d),u=v,f=a("7a94"),g={name:"Canvas",data:function(){return{bgDrag:!1,tokenRef:{},objectSelected:!1,tokens:{},canvas:{},minimap:{},changing:!1,backgrounds:{},bgSelected:0}},computed:{selected:{get:function(){return this.$store.state.selected},set:function(e){return this.$store.dispatch("setSelected",e)}}},methods:{testMethod:function(){console.log(this.canvas.getActiveObject())},resetZoom:function(){this.canvas.setViewportTransform([1,0,0,1,0,0]),console.log("resetZoom")},removeToken:function(){var e=this,t=this.canvas.getActiveObject();if(t){var a=[];"activeSelection"==t.type?a=t._objects:a.push(t),a.forEach((function(t){var a=e.tokenRef.child(t.__id);a.remove()}))}},getTokenFromId:function(e){return this.canvas.getObjects().filter((function(t){return t.__id===e}))[0]},addTokenDrag:function(e){var t=this;if(this.bgDrag)this.addBg(e);else{var a=e.dataTransfer.getData("Text"),n=new Image;n.addEventListener("load",(function(n){var s=n.target.naturalWidth,o=n.target.naturalHeight,c="token_"+Object.keys(t.tokens).length,i={name:c,url:a,top:e.clientY-o/2,left:e.clientX-s/2,angle:0,scaleX:1,scaleY:1,race:"",notes:""};t.tokenRef.push(i)})),n.src=a}},addBg:function(e){var t=this;console.log("add bg method");var a=e.dataTransfer.getData("Text"),n=new Image;n.addEventListener("load",(function(e){var n=e.target.naturalWidth,s=e.target.naturalHeight,o="bg_"+Object.keys(t.backgrounds).length,c={name:o,url:a,height:s,width:n,scaleX:1,scaleY:1};t.bgRef.push(c)})),n.src=a,this.bgDrag=!1}},mounted:function(){var e=this,t=this.$refs.can,a=this.$refs.mini;this.canvas=new f["fabric"].Canvas(t,{fireRightClick:!0,fireMiddleClick:!0,stopContextMenu:!0});var n=window.innerWidth,s=window.innerHeight-100;this.canvas.setDimensions({width:n,height:s}),this.minimap=new f["fabric"].Canvas(a,{selection:!1}),this.tokenRef=u.database().ref("tokens"),this.bgRef=u.database().ref("backgrounds"),window.addEventListener("resize",(function(){var t=window.innerWidth,a=window.innerHeight-100;e.canvas.setDimensions({width:t,height:a})})),this.canvas.on("mouse:down",(function(t){var a=t.e;2!==a.button&&!0!==a.altKey||(e.canvas.isDragging=!0,e.canvas.selection=!1,e.canvas.lastPosX=a.clientX,e.canvas.lastPosY=a.clientY)})),this.canvas.on("mouse:move",(function(t){if(e.canvas.isDragging){var a=t.e,n=e.canvas.viewportTransform;n[4]+=a.clientX-e.canvas.lastPosX,n[5]+=a.clientY-e.canvas.lastPosY,e.canvas.requestRenderAll(),e.canvas.lastPosX=a.clientX,e.canvas.lastPosY=a.clientY}})),this.canvas.on("mouse:up",(function(){e.canvas.setViewportTransform(e.canvas.viewportTransform),e.canvas.isDragging=!1,e.canvas.selection=!0})),this.canvas.on("mouse:wheel",(function(t){var a=t.e.deltaY,n=e.canvas.getZoom();n*=Math.pow(.999,a),n>20&&(n=20),n<.1&&(n=.1),e.canvas.zoomToPoint({x:t.e.offsetX,y:t.e.offsetY},n),t.e.preventDefault(),t.e.stopPropagation()})),this.tokenRef.on("value",(function(t){var a=t.val();if(a){var n=[];Object.keys(a).forEach((function(e){var t=Object(r["a"])({},a[e]);t.__id=e,n.push(t)})),e.tokens=n}})),this.bgRef.on("value",(function(t){var a=t.val();if(a){var n=[];Object.keys(a).forEach((function(e){var t=Object(r["a"])({},a[e]);t.__id=e,n.push(t)})),e.backgrounds=n,e.bgSelected=e.backgrounds.length-1,f["fabric"].Image.fromURL(e.backgrounds[e.bgSelected].url,(function(t){e.canvas.setBackgroundImage(t),t.scaleToHeight(e.canvas.getHeight()),e.canvas.renderAll.bind(e.canvas)}))}})),this.tokenRef.on("child_added",(function(t){console.log("CHILD_ADDED",t.val().url);var a=t.val();f["fabric"].Image.fromURL(a.url,(function(n){e.canvas.add(n).setActiveObject(n);var s=new f["fabric"].Shadow({color:"black",blur:50,offsetX:5,offsetY:5,opacity:.5});n.set({__id:t.key,top:a.top,left:a.left,scaleX:a.scaleX,scaleY:a.scaleY,angle:a.angle,shadow:s,name:a.name,race:a.race,notes:a.notes}),n.setCoords()}))})),this.canvas.on("selection:created",(function(t){console.log("object selected"),e.objectSelected=!0;var a=e.canvas.getActiveObject();a&&"activeSelection"!=a.type&&(e.selected=a.toJSON(["__id","name","race","notes"]),t.target.set({scaleX:t.target.scaleX/1.1,scaleY:t.target.scaleX/1.1}),e.canvas.renderAll())})),this.canvas.on("selection:cleared",(function(){console.log("object deselected"),e.objectSelected=!1,e.selected=!1})),this.canvas.on("selection:updated",(function(){console.log("object selection updated"),e.objectSelected=!0;var t=e.canvas.getActiveObject();t&&"activeSelection"!=t.type&&(e.selected=t.toJSON(["__id","name","race","notes"]))})),this.canvas.on("object:moving",(function(){e.changing=!0})),this.canvas.on("object:rotating",(function(){e.changing=!0})),this.canvas.on("object:scaling",(function(){e.changing=!0})),this.canvas.on("mouse:over",(function(t){null!=t.target&&(e.objectSelected||e.canvas.isDragging||(t.target.set({scaleX:1.1*t.target.scaleX,scaleY:1.1*t.target.scaleX}),e.canvas.renderAll()))})),this.canvas.on("mouse:out",(function(t){null!=t.target&&(e.objectSelected||e.canvas.isDragging||(t.target.set({scaleX:t.target.scaleX/1.1,scaleY:t.target.scaleX/1.1}),e.canvas.renderAll()))})),this.canvas.on("object:modified",(function(t){if(e.changing&&"textbox"!==t.target.type){console.log("im here now again");var a=[];if(void 0!=t.target._objects){var n=e.canvas.getActiveObjects(),s=e.canvas.toJSON(["__id","name","race","notes"]).objects;n.forEach((function(e){s.forEach((function(t){e.__id===t.__id&&a.push(t)}))}))}else a.push(t.target);a.forEach((function(t){var a=e.tokenRef.child(t.__id),n={top:t.top,left:t.left,scaleX:t.scaleX,scaleY:t.scaleY,angle:t.angle};a.update(n)})),e.changing=!1}})),this.tokenRef.on("child_removed",(function(t){console.log("CHILD_REMOVED");var a=t.key;console.log(a);var n=e.getTokenFromId(a);e.canvas.remove(n)})),this.tokenRef.on("child_changed",(function(t){if(!e.changing){e.canvas.discardActiveObject();var a=t.val(),n=t.key;for(var s in e.canvas._objects)e.canvas._objects[s].__id===n&&(e.canvas._objects[s].animate("left",a.left,{}),e.canvas._objects[s].animate("top",a.top,{onChange:e.canvas.renderAll.bind(e.canvas)}),e.canvas._objects[s].set({scaleX:a.scaleX,scaleY:a.scaleY,angle:a.angle,name:a.name,race:a.race,notes:a.notes}),e.canvas._objects[s].setCoords(),e.canvas.requestRenderAll())}}))}},p=g,h=(a("50fb"),a("2877")),b=a("6544"),m=a.n(b),_=a("8336"),k=a("b0af"),w=a("a523"),j=Object(h["a"])(p,c,i,!1,null,"e0adc908",null),S=j.exports;m()(j,{VBtn:_["a"],VCard:k["a"],VContainer:w["a"]});var x=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-container",{staticClass:"pa-1"},[a("v-expansion-panels",{attrs:{focusable:"",accordion:"",multiple:""}},[a("v-expansion-panel",[a("v-expansion-panel-header",{on:{click:function(t){e.selectionToggle=!e.selectionToggle}}},[e._v("Selection")]),a("v-expansion-panel-content",{directives:[{name:"show",rawName:"v-show",value:e.showSelected,expression:"showSelected"}]},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.selected,expression:"selected"}]},[a("v-img",{attrs:{src:e.selected.src}}),a("div",[a("span",{staticClass:"overline"},[e._v("Name: ")]),a("span",{staticClass:"caption"},[e._v(e._s(e.selected.name))])]),a("div",[a("span",{staticClass:"overline"},[e._v("Race: ")]),a("span",{staticClass:"caption"},[e._v(e._s(e.selected.race))])]),a("div",[a("v-divider"),a("span",{staticClass:"overline"},[e._v("Notes: ")]),a("span",{staticClass:"caption"},[e._v(e._s(e.selected.notes))])],1),a("v-btn",{attrs:{icon:"",dark:"",color:"yellow"},on:{click:function(t){e.editTokenDialog=!0}}},[a("v-icon",[e._v("mdi-playlist-edit")])],1)],1),e.selected?e._e():a("div",{staticClass:"caption"},[e._v("No Selection")])])],1),a("v-expansion-panel",[a("v-expansion-panel-header",[e._v("OBJECTS")]),a("v-expansion-panel-content")],1)],1)],1),a("v-dialog",{attrs:{persistent:"","max-width":"600px"},model:{value:e.editTokenDialog,callback:function(t){e.editTokenDialog=t},expression:"editTokenDialog"}},[a("v-card",[a("v-card-title",[a("span",{staticClass:"headline"},[e._v("Edit Token")])]),a("v-card-text",[a("v-container",[a("v-text-field",{attrs:{label:"Name",required:""},model:{value:e.selected.name,callback:function(t){e.$set(e.selected,"name",t)},expression:"selected.name"}}),a("v-text-field",{attrs:{label:"Race"},model:{value:e.selected.race,callback:function(t){e.$set(e.selected,"race",t)},expression:"selected.race"}}),a("v-textarea",{attrs:{label:"Notes"},model:{value:e.selected.notes,callback:function(t){e.$set(e.selected,"notes",t)},expression:"selected.notes"}})],1),a("small",[e._v("*indicates required field")])],1),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:function(t){e.editTokenDialog=!1}}},[e._v(" Close ")]),a("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:e.saveToken}},[e._v(" Save ")])],1)],1)],1)],1)},T=[],y={name:"SidePanel",data:function(){return{selectionToggle:!1,editTokenDialog:!1,images:[{name:"Donald Trump",url:"http://i.imgur.com/QcJru0b.png"},{name:"Hilary Clinton",url:"http://i.imgur.com/Yp9zAaY.png"},{name:"Bernie Sanders",url:"http://i.imgur.com/K4ZroX1.png"},{name:"Barack Obama",url:"http://i.imgur.com/j7zfXYB.png"},{name:"Joe Biden",url:"http://i.imgur.com/ZACKyqE.png"}]}},computed:{selected:{get:function(){return this.$store.state.selected},set:function(e){return this.$store.dispatch("setSelected",e)}},showSelected:function(){return this.selected&&this.selectionToggle}},methods:{saveToken:function(){var e=u.database().ref("tokens"),t=e.child(this.selected.__id);t.update(this.selected),this.editTokenDialog=!1}}},C=y,D=(a("cd27"),a("99d9")),O=a("169a"),V=a("ce7e"),E=a("cd55"),X=a("49e2"),Y=a("c865"),A=a("0393"),P=a("132d"),R=a("adda"),I=a("2fa4"),B=a("8654"),N=a("a844"),$=Object(h["a"])(C,x,T,!1,null,null,null),M=$.exports;m()($,{VBtn:_["a"],VCard:k["a"],VCardActions:D["a"],VCardText:D["b"],VCardTitle:D["c"],VContainer:w["a"],VDialog:O["a"],VDivider:V["a"],VExpansionPanel:E["a"],VExpansionPanelContent:X["a"],VExpansionPanelHeader:Y["a"],VExpansionPanels:A["a"],VIcon:P["a"],VImg:R["a"],VSpacer:I["a"],VTextField:B["a"],VTextarea:N["a"]});var H={name:"App",components:{Canvas:S,SidePanel:M},data:function(){return{drawer:!1}}},L=H,J=(a("034f"),a("7496")),z=a("40dc"),Z=a("5bc1"),q=a("f6c4"),K=a("f774"),W=Object(h["a"])(L,s,o,!1,null,null,null),U=W.exports;m()(W,{VApp:J["a"],VAppBar:z["a"],VAppBarNavIcon:Z["a"],VImg:R["a"],VMain:q["a"],VNavigationDrawer:K["a"],VSpacer:I["a"]});var F=a("f309");n["a"].use(F["a"]);var Q=new F["a"]({theme:{dark:!0}}),G=a("2f62");n["a"].use(G["a"]);var ee=new G["a"].Store({state:{count:0,hello:"WORLD",selected:{}},getters:{selected:function(e){return e.selected}},mutations:{SET_SELECTED:function(e,t){e.selected=t}},actions:{setSelected:function(e,t){var a=e.commit,n=e.state;return a("SET_SELECTED",t),n.selected}}});n["a"].config.productionTip=!1,new n["a"]({vuetify:Q,store:ee,render:function(e){return e(U)}}).$mount("#app")},"85ec":function(e,t,a){},cd27:function(e,t,a){"use strict";a("439a")},f3d9:function(e,t,a){}});
//# sourceMappingURL=app.59197375.js.map